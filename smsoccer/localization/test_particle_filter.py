import pygame
from pygame.locals import *


# Window size
from time import sleep
from smsoccer.localization import particlefilter
from smsoccer.localization.particlefilter import ParticleFilter

width, height = 750, 600
# Window
pygame.init()
window = pygame.display.set_mode((width, height), HWSURFACE | DOUBLEBUF | RESIZABLE)

data = [[1.9138558074183545, 31.32223130892581, 209.34178608545565],
        [1.9138558074183545, 31.32223130892581, 209.34178608545565],
        [1.9138558074183545, 31.32223130892581, 209.34178608545565],
        [-49.80295250429013, -6.897113986501982, 148.864754071608],
        [-49.80295250429013, -6.897113986501982, 148.864754071608],
        [-49.80295250429013, -6.897113986501982, 148.864754071608],
        [-49.80295250429013, -6.897113986501982, 148.864754071608],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.74066350387924, -5.451711906309817, 152.4407068999872],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.32054517836538, 2.299276548838842, 170.05228404986212],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-49.9072107667231, -2.165472860183866, 159.85328672023076],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-46.00027352737564, 9.20419837949994, 184.21163444411698],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747],
        [-51.65907745649194, 3.764023857153414, 171.81648720245747]]

hfield_width = 52.5
hfield_heigh = 35.0


def convert(x, y):
    # center of the field
    mult = 6.0
    cx, cy = hfield_width * mult, hfield_heigh * mult
    mx, my = 30 + cx, 20 + cy

    x, y = mx + mult * x, my + mult * y
    return x, y


if __name__ == "__main__":
    # Ground through
    gt = [-50, 0, -173]
    pf = ParticleFilter(gt)
    # print pf.particles


    # # dash
    # pf.dash_particles(10)
    # print pf.particles, pf.e_position
    # #
    # # #rotate
    # # pf.rotate_particles(30)
    # # print pf.particles, pf.e_position




    for d in data[:]:


        pf.dash_particles(0)

        pf.update_particles(d)
        print pf.e_position, d

        rd = 5


        # Draw the canvas
        window.fill((255, 255, 255))

        ox, oy = convert(-hfield_width, -hfield_heigh)
        fx, fy = convert(hfield_width, hfield_heigh)
        pygame.draw.rect(window, (55, 171, 84), (ox, oy, fx - ox, fy - oy))
        pygame.draw.rect(window, (0, 0, 0), (ox, oy, fx - ox, fy - oy), 1)


        # draw particles
        for i in range(particlefilter.N):
            px, py = convert(pf.particles[i][0], pf.particles[i][1])

            pygame.draw.circle(window, (200, 0, 0), (int(px), int(py)), int(2), 0)

        ex, ey = convert(pf.e_position[0], pf.e_position[1])
        # draw estimation
        pygame.draw.circle(window, (0, 0, 200), (int(ex), int(ey)), int(5), 0)

        pygame.display.flip()
        sleep(1)

        # window = pygame.display.set_mode(event.dict['size'],
        #                                          HWSURFACE | DOUBLEBUF | RESIZABLE)



        #
        # print pf.particles, pf.e_position